#!/usr/bin/env python
"""etym

Queries etymonline.com for word or phrase, and displays 
its etymology if found. Also supports looking up a random word.

Usage:
    etym [options] <word> ...
    etym [options] --random [--number=<num>]

Examples:
    etym viking
    etym --random
    etym -rn 7

Arguments:
    <word>      word (or phrase) to look up

Options:
    -h --help               Show this screen.
    -v --verbose            Verbose mode.
    -r --random             Look up random word.
    -n --number=<num>       Number of random words to look up [default: 1].
"""
import os
import sys
import re
import random
import requests
from textwrap import fill

from BeautifulSoup import BeautifulSoup
from blessings import Terminal
from docopt import docopt
from etym.exceptions import NoResultsFound



def performLookup(query, verbose=None, random=None):

    for attempts in range(5):
        try:
            (hit, etymology) = queryEtymOnline(query, verbose=verbose)

        except NoResultsFound:
            if verbose:
                print "FAIL"
            if random:
                query = getRandomWord()
                continue
            else:
                sys.exit("No etymology found for '%s'." % query)

        except requests.exceptions.ConnectionError:
            sys.exit("Could not query etymonline.com; check internet connection.")

        break

    return (hit, etymology)

def main(args):

    if args['<word>']:
        query = ' '.join(args['<word>'])

    if args['--random']:
    
        attempts = int(args['--number'])

        while attempts > 0:
            query = getRandomWord()
            (hit, etymology) = performLookup(query, verbose=args['--verbose'], random=args['--random'])
            displayResults(hit, etymology)
            # Pad the entries with a line break, for better readability 
            # when displaying multiple results.
            attempts -= 1
            if attempts > 0:
                print ''

    else:
        (hit, etymology) = performLookup(query, verbose=args['--verbose'], random=args['--random'])
        displayResults(hit, etymology)

if __name__ == '__main__':
    arguments = docopt(__doc__, version='etym v0.1')
    main(arguments)
